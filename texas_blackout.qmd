---
title: "2021 Texas Blackout and Income Disparity"
author: "Nathalie Bonnet"
date: 2025-11-10
format: html
execute: 
  warning: false
  message: false
---

## Setup Code

1.  Loading necessary libraries

```{r}
#| output: false
# Read in necessary libraries
library(tidyverse)
library(sf)
library(here)
library(tmap)
library(patchwork)
library(stars)
```

2.  Importing data

```{r}
#| output: false
# Check names to pull out income and geography data from census tract
st_layers(here("data", "ACS_2019_5YR_TRACT_48_TEXAS.gdb"))

# Read income layer
income <- read_sf(here("data", "ACS_2019_5YR_TRACT_48_TEXAS.gdb"), layer = "X19_INCOME")

# Read polygon data from census
geography <- st_read(here("data", "ACS_2019_5YR_TRACT_48_TEXAS.gdb"), layer = "ACS_2019_5YR_TRACT_48_TEXAS")

# 2021-02-07 data geography 1
pre_light1 <- stars::read_stars(here("data", "VNP46A1", "VNP46A1.A2021038.h08v05.001.2021039064328.tif"))

# 2021-02-07 data geography 2
pre_light2 <- stars::read_stars(here("data", "VNP46A1", "VNP46A1.A2021038.h08v06.001.2021039064329.tif"))

# 2021-02-16 data geography 1
post_light1 <- stars::read_stars(here("data", "VNP46A1", "VNP46A1.A2021047.h08v05.001.2021048091106.tif"))

# 2021-02-16 data geography 2
post_light2 <- stars::read_stars(here("data", "VNP46A1", "VNP46A1.A2021047.h08v06.001.2021048091105.tif"))

# Read in residential data
houses <- st_read(here("data", "gis_osm_buildings_a_free_1.gpkg", "gis_osm_buildings_a_free_1.gpkg"), query = "SELECT *
FROM gis_osm_buildings_a_free_1
WHERE (type IS NULL AND name IS NULL)
OR type in ('residential', 'apartments', 'house', 'static_caravan', 'detached')")

# Road data 
roads <- st_read(here("data", "gis_osm_roads_free_1.gpkg", "gis_osm_roads_free_1.gpkg"), query = "SELECT * 
FROM gis_osm_roads_free_1 
WHERE fclass='motorway'")
```

## Combine satellite images and crop to Houston area

```{r}
#| output: false
# Combine all light areas from pre and post blackout dates
feb_7_comb <- st_mosaic(pre_light1, pre_light2)

feb_16_comb <- st_mosaic(post_light1, post_light2)

# Crop to only Houston area where we are interested in
# Create a bounding box apply to lights images, ensure they use the same crs
houston_crop <- st_bbox(c(xmin = -96.5,  xmax = -94.5, ymin = 29, ymax = 30.5), crs = st_crs(4326))

# Apply bbox to both stars objects
feb7_cropped <- st_crop(feb_7_comb, y = houston_crop)

feb16_cropped <- st_crop(feb_16_comb, y = houston_crop)

# Check that all cordinates are actually equivalent to be added for raster
if (all(st_bbox(feb7_cropped) == st_bbox(feb16_cropped))) {
  print("bounding boxes are equivalent")
} else {
  warning("bounding boxes do not match")
}
```

## Produce maps for change in night light intensity after storms

```{r, fig.cap = "Map 1. Maps of NASA Worldview satellite imagery data from Houston before and after the 2021 snowstorm that caused statewide blackouts. The image from February 7 shows light intensity centering within the urban areas of Houston, and the image from February 16 shows a large scale blackout in these areas.", fig.width=10, fig.height=5}
# Plot to show change in night lights between February 7 and 16

feb7_map <- tm_shape(feb7_cropped) +
tm_raster(col.scale = tm_scale_continuous(values =  "-greys"), col.legend = tm_legend(title = "Luminescence (nW cm-2sr-1)", orientation = "landscape")) +
  tm_scalebar(position = tm_pos_in("left", "top"), 
              text.color = "white", 
              text.size = 0.3, 
              color.dark = "darkgrey")+
  tm_compass(color.dark = "darkgrey", 
             text.color = "white") +
  tm_title(text = "Pre Blackout (2021-02-07)")

feb16_map <- tm_shape(feb16_cropped) +
  tm_raster(col.scale = tm_scale_continuous(values =  "-greys"), col.legend = tm_legend(title = "Luminescence (nW cm-2sr-1)", orientation = "landscape")) +
  tm_scalebar(position = tm_pos_in("left", "top"), 
              text.color = "white", 
              text.size = 0.3, 
              color.dark = "darkgrey")+
  tm_compass(color.dark = "darkgrey", 
             text.color = "white") +
  tm_title(text = "Post Blackout (2021-02-16)") 

tmap_arrange(feb7_map, feb16_map, outer.margins = 0.01)
```

## Create blackout mask (isolate cells where blackouts occurred)

```{r}
# Subtract images to find the difference in luminescence 
diff <- (feb7_cropped - feb16_cropped)

# Reassign difference raster to a new object to save from errors
blackout_mask <- (diff > 200)

# Set cells where the difference is not greater than 200 to NA (these are non blacked out areas)
blackout_mask[[1]][blackout_mask[[1]] == FALSE] <- NA

# Vectorize mask
blackout_vector <- st_as_sf(blackout_mask)

# Validate boundaries
blackout_vector <- st_make_valid(blackout_vector)

# Reproject to EPSG:3083
blackout_projected <- st_transform(blackout_vector, 3083)

```

## Exclude highways from the blackout mask

```{r}
#| output: false
# Check if the CRS is shared between blackout mask and roads data
if (st_crs(blackout_projected) == st_crs(roads)) {
  print("CRS is equal")
} else {
  warning("CRS is not the same")
  print(paste("Roads CRS:", st_crs(roads)))
}
```

```{r, fig.cap = "Map 2. A map of the homes in Houston, TX that were identified using a difference in light intensity from satellite imagery as having lost power during the 2021 February snowstorm. Road data is included to emphasize the density of urban areas.", fig.width=10, fig.height=9}
# Set CRS to be equal
roads <- st_transform(roads, crs = st_crs(blackout_projected))

# Aggregate roads data
roads_union <- st_union(roads)

# Create buffer object
roads_buffer <- st_buffer(roads_union, 200)

# Join road data with blackout mask
blackout_roads <- st_difference(blackout_projected, roads_buffer)

houses <- st_transform(houses, crs = st_crs(blackout_roads))

blackout_res <- st_intersection(houses, blackout_roads)

# Map homes that lost power 
tm_shape(blackout_res) + 
  tm_polygons() + 
  tm_shape(roads_buffer) +
  tm_lines(col = "#4668A7") +
  tm_basemap("CartoDB.PositronNoLabels") +
  tm_graticules() +
  tm_title(text = "Houston Homes Affected by the 2021 Snow Storm Blackout")

# How many homes lost power?
power_out <- length(blackout_res$osm_id)
```

The number of homes that lost power as a result of the 2021 snow storm was: `r power_out`.

## Socioeconomic analysis

1.  Find census tracts that experienced blackouts and map over Houston area

```{r, fig.cap = "Map 3. Map of the census tracts identified as being affected by the 2021 Texas blackout event.", fig.width=10, fig.height=9}
# Fix column name that needs to be joined on so it is the same in both dataframes
income <- income %>% 
  rename(GEOID_Data = GEOID)

# Join geography onto income data
socio <- left_join(geography, income, by = "GEOID_Data")

# Check that CRS of income and residence in formation is the same and transform if not
if (all(st_crs(socio) == st_crs(blackout_res))) {
  print("CRS matches")
} else {
  warning("CRS of objects do not match")
  socio <- st_transform(socio, crs = st_crs(blackout_res))
}

blackout_res_union <- st_union(blackout_res)

socio_spatial <- st_filter(socio, blackout_res_union)

socio_subset <- socio_spatial %>% 
  select(B19013e1, COUNTYFP, TRACTCE)

tm_shape(socio_subset) +
  tm_polygons(fill = "#93B7FC") +
  tm_basemap("CartoDB.PositronNoLabels") +
  tm_graticules() +
  tm_title(text = "Census Tracts Affected by the 2021 Snow Storm Blackout")

```

2.  Find the average household income for each census tract and compare by blackout status

```{r, fig.cap = "Figure 1. Boxplot comparing the median household income from census tracts that were identified as being affected by the 2021 blackout or not. The tracts from homes with blackouts show a higher median houshold income that those identified as not experiencing blackouts.", fig.width=10, fig.height=9}
# Reassign blackout census data and rename median income column
census_blacked <- socio_subset %>% 
  rename("median_income" = B19013e1)

# Filter out census ids that are in the blackout areas to find non blackout areas and filter df
census_non_blacked <- socio %>% 
  filter(!(socio$GEOID_Data %in% socio_spatial$GEOID_Data)) %>% 
  select(B19013e1, COUNTYFP, TRACTCE) %>% 
  rename("median_income" = B19013e1)

# Create a new column on each dataframe with whether this is a blackout or not tract
census_blacked$blackout_status <- "blackout"
census_non_blacked$blackout_status <- "no blackout"

# Select only columns that are needed for plotting and drop geometry for easier processing
blacked <- census_blacked %>% 
  select(median_income, blackout_status) %>% 
  st_drop_geometry()

non_blacked <- census_non_blacked %>% 
  select(median_income, blackout_status) %>% 
  st_drop_geometry()

# Join dataframes to plot
median_inc_comb <- rbind(blacked, non_blacked)

# Plot median income by blackout or not
ggplot(median_inc_comb,
       aes(x = blackout_status, 
           y = median_income, 
           fill = blackout_status)) +
  geom_boxplot(width = 0.5,
               outlier.size = 0.8,
               alpha = 0.8) +
  stat_summary(fun="median", geom="text", aes(label=after_stat(y)), vjust=-0.5) +
  scale_fill_manual(values = c("#4668A7", "#9A031E")) +
  scale_y_continuous(minor_breaks = seq(from = 0, to = 250000, by = 10000)) +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(title = "Household Income in Houston Homes by Blackout Status", x = "Blackout status", y = "Income (U.S. dollars)")
```

## Discussion

According to the difference in light intensity identified with NASA's Worldview satellite imagery, the number of individual homes in Houston that lost power during the 2021 snow storm was about 169,000. Aggregating data about homes that experienced blackouts and those that did not by census tract, the median household income of census tracts that experienced blackout versus those that didn't was higher. From Map 1. we can see that areas that appear to have a greater difference in light intensity center in a more urban area. The perfect area of resolution to analyze the socioeconomic disparity between those affected by blackout would be at an individual level. However, the necessity of aggregating large spatial data for population level analysis may have resulted in less representative results as dense urban areas generally have many small aggregation units where suburban and rural areas have fewer larger units, which can skew results.

## References

| Data | Citation | Sources |
|---------------------------|------------------|---------------------------|
| OpenStreetMap | OpenStreetMap Contributors. (2025). OpenStreetMap database. https://planet.openstreetmap.org/| <https://planet.openstreetmap.org/> |
| Geofabrik distribution | OpenStreetMap Data Extracts. Geofabrik Download Server. https://download.geofabrik.de/ | <https://download.geofabrik.de/> |
| U.S. Census Data | U.S. Census Bureau. (2020). TIGER/Line Shapefiles and American Community Survey 2019 (5-Year-Estimates), Texas-Census Tract Level (ACS_2019_5YR_TRACT_48_TEXAS). U.S. Department of Commerce. https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-data.html | <https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-data.html> |
| NASA VNP46 | Earth Science Data Systems, N. (2024, July 23). Level-1 and Atmosphere Archive and Distribution System Distributed Active Archive Center. https://www.earthdata.nasa.gov/centers/laads-daac | <https://ladsweb.modaps.eosdis.nasa.gov/> |
